!function(){"use strict";(window||global).regeneratorRuntime=void 0;var e=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var n=function(n){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?t(Object(o),!0).forEach(function(t){e(n,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}({},{ERR_UNKNOWN:{errCode:500,errMsg:"未知错误"},ERR_NET_FAIL:{errCode:1e3,errMsg:"网络错误"},ERR_PARAMS:{errCode:30001,errMsg:"参数错误"}},{},{EVT_SDK_READY:"EVT_SDK_READY",EVT_ON_SHOW:"EVT_ON_SHOW",EVT_ON_HIDE:"EVT_ON_HIDE",EVT_ON_ERROR:"EVT_ON_ERROR",EVT_LOGIN_START:"EVT_LOGIN_START",EVT_ON_LOGIN:"EVT_ON_LOGIN",EVT_UPDATE_START:"EVT_UPDATE_START",EVT_ON_UPDATE:"EVT_ON_UPDATE",EVT_LOGIN_FAIL:"EVT_LOGIN_FAIL",EVT_REPORT_LOG:"EVT_REPORT_LOG",EVT_SET_GAMEUSER:"EVT_SET_GAMEUSER"},{},{ENV_TEST:"Test",ENV_PROD:"Prod",ENV_DEV:"Dev"},{},{PROC_PRE_AGGR:"PROC_PRE_AGGR",PROC_REQ_AGGR:"PROC_REQ_AGGR"}),r=window||global||{};r.$__sdk__||(r.$__sdk__={});var o={platform:r.$__sdk__.platform},i=1,a=2,s=3,c=4,u=i,f=function(e){return"[SDK] ".concat(e)},h={setLevel:function(e){u=e},debug:function(e){if(u<=i){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).log.apply(t,[f(e)].concat(r))}},info:function(e){if(u<=a){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).info.apply(t,[f(e)].concat(r))}},warn:function(e){if(u<=s){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).warn.apply(t,[f(e)].concat(r))}},error:function(e){if(u<=c){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=console).error.apply(t,[f(e)].concat(r))}}};function g(e,t){return e(t={exports:{}},t.exports),t.exports}var d=g(function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,n,r){var o=t&&t.prototype instanceof _?t:_,i=Object.create(o.prototype),a=new R(r||[]);return i._invoke=function(e,t,n){var r=f;return function(o,i){if(r===g)throw new Error("Generator is already running");if(r===d){if("throw"===o)throw i;return D()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=y(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=d,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=g;var c=u(e,t,n);if("normal"===c.type){if(r=n.done?d:h,c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=d,n.method="throw",n.arg=c.arg)}}}(e,n,a),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f="suspendedStart",h="suspendedYield",g="executing",d="completed",p={};function _(){}function l(){}function v(){}var m={};m[i]=function(){return this};var E=Object.getPrototypeOf,O=E&&E(E(A([])));O&&O!==n&&r.call(O,i)&&(m=O);var S=v.prototype=_.prototype=Object.create(m);function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function I(e,t){var n;this._invoke=function(o,i){function a(){return new t(function(n,a){!function n(o,i,a,s){var c=u(e[o],e,i);if("throw"!==c.type){var f=c.arg,h=f.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then(function(e){n("next",e,a,s)},function(e){n("throw",e,a,s)}):t.resolve(h).then(function(e){f.value=e,a(f)},function(e){return n("throw",e,a,s)})}s(c.arg)}(o,i,n,a)})}return n=n?n.then(a,a):a()}}function y(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,y(e,n),"throw"===n.method))return p;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var o=u(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,p;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,p):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,p)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function A(e){if(e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:D}}function D(){return{value:t,done:!0}}return l.prototype=S.constructor=v,v.constructor=l,v[s]=l.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===l||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},T(I.prototype),I.prototype[a]=function(){return this},e.AsyncIterator=I,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new I(c(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},T(S),S[s]="Generator",S[i]=function(){return this},S.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=A,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(b),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),b(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;b(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),p}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}),p=Object.freeze({__proto__:null,default:d,__moduleExports:d}),_=p&&d||p;function l(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}var v=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){l(i,r,o,a,s,"next",e)}function s(e){l(i,r,o,a,s,"throw",e)}a(void 0)})}},m={request:function(e,t,n,r,i){var a=arguments,s=this;return v(_.mark(function c(){var u,f,g,d,p,l,v;return _.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return u=!(a.length>5&&void 0!==a[5])||a[5],f=null,c.prev=2,g=Object.assign({},i,{"content-type":u?"application/json":"application/x-www-form-urlencoded"}),d=s._jointQuery(t,n||{}),c.next=7,o.platform.network.request(e,d,r,g);case 7:if(p=c.sent,l=p.data,v=void 0===l?{}:l,!s._checkRespValid(p)){c.next=11;break}return c.abrupt("return",{meta:v.meta,data:v.data});case 11:f=v.meta,c.next=18;break;case 14:c.prev=14,c.t0=c.catch(2),h.warn("request get failed",c.t0),f=c.t0;case 18:return c.next=20,s._onFailed(f);case 20:return c.abrupt("return",c.sent);case 21:case"end":return c.stop()}},c,null,[[2,14]])}))()},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.request("GET",e,t)},post:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.request("POST",e,n,t,{},!0)},postForm:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.request("POST",e,n,t,{},!1)},_onFailed:function(e){var t=e&&e.errCode?e:n.ERR_NET_FAIL;return Promise.reject(t)},_checkRespValid:function(e){return 200===e.statusCode&&e.data&&(!e.data.meta||0===e.data.meta.errCode)},_jointQuery:function(e,t){return Object.keys(t).forEach(function(n,r){var o=0===r&&e.indexOf("?")<0?"?":"&";e+="".concat(o).concat(n,"=").concat(t[n])}),e}},E={isFun:function(e){return"function"==typeof e},isNull:function(e){return null===e||void 0===e},toNStr:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"string"==typeof e?e:this.toStr(e,t)},toStr:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.isNull(e))return t;try{return JSON.stringify(e)}catch(e){return t}},toNumber:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{return Number(e)||t}catch(e){return t}},toBoolean:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{return!!JSON.parse(e)}catch(n){return!!e||t}},toObject:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;try{return JSON.parse(e)}catch(e){return t}},isEmpty:function(e){return this.isNull(e)||""===e},wait:function(e){return new Promise(function(t){setTimeout(t,e)})},toLine:function(e){return e.replace(/([A-Z])/g,"_$1").toLowerCase()},startsWith:function(e,t){return e.slice(0,t.length)===t},endsWith:function(e,t){return-1!==e.indexOf(t,e.length-t.length)},generateGuid:function(){for(var e=[],t=0;t<36;++t)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}};function O(){this.timer=null}O.prototype={setTimer:function(e){this.timer=e},getTimer:function(){return this.timer}};var S={getTime:function(){return Date.now()},getTimeSec:function(){return Math.floor(this.getTime()/1e3)},todayStart:function(e){var t=e?new Date(e):new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()},toMSecond:function(e){return 3600*e*1e3},resetInterval:function(e,t){var n=new O;return n.setTimer(setTimeout(function r(){e&&!1!==e()&&n.setTimer(setTimeout(r,t))},t)),n},reclearInterval:function(e){var t=e&&e.getTimer?e.getTimer():null;t&&(clearTimeout(t),e.setTimer(null))}},T={geVersion:function(e,t){return this._compareVersion(e,t)>=0},ltVersion:function(e,t){return this._compareVersion(e,t)<0},_compareVersion:function(e,t){for(var n=e.split("."),r=t.split("."),o=Math.max(n.length,r.length),i=0;i<o;i++){var a=parseInt(n[i],10)||0,s=parseInt(r[i],10)||0;if(a>s)return 1;if(a<s)return-1}return 0}},I=g(function(e){function t(n){"@babel/helpers - typeof";return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t});function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var w=function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?y(Object(r),!0).forEach(function(n){e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},E,{},S,{},T,{},{pkgError:function(e,t){return{errCode:e&&e.errCode||t.errCode,errMsg:e&&(e.errMsg||e.message)||t.errMsg}}},{},{reset:function(e,t){var n=Object.assign({},e);return Object.keys(t||{}).forEach(function(r){E.isNull(e[r])&&!E.isNull(t[r])&&(n[r]=t[r])}),n},copy:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(E.isNull(e))return{};var n={};return Object.keys(e).forEach(function(r){t&&t.indexOf(r)>-1||E.isNull(e[r])||(n[r]=e[r])}),n},deepCopyTo:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return null===e||"object"!==I(e)||!t||0!==r&&i>=r?e:(Object.keys(e).forEach(function(a){o&&o.indexOf(a)>-1||(t[a]=n.deepCopyTo(e[a],t[a],r,o,++i))}),t)},queryToJson:function(e){if(E.isEmpty(e))return{};try{var t={};return decodeURIComponent(e).split("&").forEach(function(e){if(e&&e.split){var n=e.split("=");t[n[0]]=n[1]}}),t}catch(e){return{}}},jsonToQuery:function(e,t){if(E.isNull(e))return"";try{var n=[];return Object.keys(e).forEach(function(r){if(!E.isNull(e[r])){var o=t?encodeURIComponent(e[r]):e[r];n.push("".concat(r,"=").concat(o))}}),n.join("&")}catch(e){return""}},addToQuery:function(e,t){var n=this.queryToJson(e),r=this.reset(n,t);return this.jsonToQuery(r)},defineProperty:function(e,t,n){if(e){var r="function"==typeof e[t]?e[t].bind(e):e[t];Object.defineProperty(e,t,{value:n(r)})}}});var b,R,A,D={},L={},N={consts:n,log:h,global:o,network:m,storage:{getString:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this._get(e,function(e){return w.toStr(e,t)})},getNumber:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._get(e,function(e){return w.toNumber(e,t)})},getBoolean:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._get(e,function(e){return w.toBoolean(e,t)})},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this._get(e,function(e){return w.toObject(e,t)})},set:function(e,t){return this._set(e,t)},remove:function(e){return o.platform.storage.removeStorage(e)},clear:function(){return o.platform.storage.clearStorage()},_get:function(e,t){return t(o.platform.storage.getStorage(e))},_set:function(e,t){var n=w.toStr(t);return o.platform.storage.setStorage(e,n)}},eventBus:{_on:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t){var o=D[e]||[];o.push({priority:n,listener:t,once:r}),D[e]=o.sort(function(e,t){return e.priority<t.priority?1:e.priority>t.priority?-1:0})}},once:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._on(e,t,n,!0)},on:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._on(e,t,n,!1)},off:function(e,t){var n=D[e];n&&(n=n.filter(function(e){return e.listener!==t}),D[e]=n)},dispatch:function(e,t){this._dispatch(e,t)},_dispatch:function(e,t){var n=D[e];if(n&&!(n.length<=0))for(var r=new function(e){var t=this;this.data=e,this._stopped=!1,this.stopPropagation=function(){t._stopped=!0},this.isStopped=function(){return t._stopped}}(t),o=0;o<n.length;o++){var i=n[o];try{i.listener(r)}catch(t){h.warn("EventBus invoke '".concat(e,"' exception: "),t)}if(i.once&&this.off(e,i.listener),r.isStopped())break}}},procCenter:{register:function(e,t){var n=L[e]||[];n.push(t),L[e]=n},getProcessors:function(e){return L[e]},process:function(e,t){var n=this;return v(_.mark(function r(){var o,i,a,s;return _.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=n.getProcessors(e)){r.next=3;break}return r.abrupt("return",t);case 3:i={},a=0;case 5:if(!(a<o.length)){r.next=13;break}return r.next=8,o[a](t);case 8:s=r.sent,i=Object.assign(i,s||{});case 10:a++,r.next=5;break;case 13:return r.abrupt("return",i);case 14:case"end":return r.stop()}},r)}))()}}},x="1.0.6",k=N.consts,P=N.eventBus,C=N.log,U={_inited:!1,init:function(e){return!!this._checkValid(e)&&(this.config=e,this._print(e),P.dispatch(k.EVT_SDK_READY,this.config),!0)},sdkConfig:function(){return this.config},_checkValid:function(e){return this._inited?(C.error("already initiated"),!1):this._checkConfigValid(e)?(this._inited=!0,!0):(C.error("initiate failed, please check config!"),!1)},_checkConfigValid:function(e){return e.env&&e.gameId&&e.gameVersion},_print:function(e){C.info("/*************************/"),C.info(" SDK(".concat(x,") initiated")),C.info(" Env: ".concat(e.env)),C.info(" GameID: ".concat(e.gameId)),C.info(" GameVersion: ".concat(e.gameVersion)),C.info("/*************************/")}},V=function(e){return U.init(e)},G=N.consts,j={HOST:(b={},e(b,G.ENV_PROD,"https://platform-douyin.hortorgames.com"),e(b,G.ENV_TEST,"https://platform-douyin-test.hortorgames.com"),e(b,G.ENV_DEV,"https://platform-douyin-dev.hortorgames.com"),b),HOST_SERVER:(R={},e(R,G.ENV_PROD,"https://platform.hortorgames.com"),e(R,G.ENV_TEST,"https://platform-test.hortorgames.com"),e(R,G.ENV_DEV,"https://platform-dev.hortorgames.com"),R),HOST_LOG:(A={},e(A,G.ENV_PROD,"https://platform.hortorgames.com"),e(A,G.ENV_TEST,"https://platform-test.hortorgames.com"),e(A,G.ENV_DEV,"https://platform-dev.hortorgames.com"),A)},M=function(){var e=U.sdkConfig().env||G.ENV_PROD,t=j.HOST;return(void 0===t?{}:t)[e]},B=function(){var e=U.sdkConfig().env||G.ENV_PROD,t=j.HOST_SERVER;return(void 0===t?{}:t)[e]},H=function(){var e=U.sdkConfig().env||G.ENV_PROD,t=j.HOST_LOG;return(void 0===t?{}:t)[e]};function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var W=function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?F(Object(r),!0).forEach(function(n){e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},{REQ_SWITCH:"/custom-switch/api/v1/switch/multi/status",REQ_NOTICES:"/capi/v1/notice",REQ_IPS_CHECK:"/ipregion/api/v1/blockstatus/multi",REQ_EXT_USER_INFO:"/wechat/user-info",REQ_AGGREGATION:"/platform-gateway-server/api/v1/aggr",REQ_LOGS:"/wxlog/api/v1/log/douyin/multi",REQ_REMOTE_LOG:"/wxlog/api/v1/log"}),q={_logs:[],_delayer:void 0,post:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(this._logs.push(e),t?this._report():this._delayReport())},_init:function(){N.eventBus.on(N.consts.EVT_REPORT_LOG,this._onReport.bind(this))},_onReport:function(e){var t=e.data||{},n=t.log,r=t.immediate;this.post(n,r)},_report:function(){var e=this._logs;this._logs=[];var t=N.global.platform.information,n=t.getUserInfo()||{},r=n.userId,o=n.uniqueId,i=n.anonymousOpenId,a=t.getConfig(),s={gameId:a.gameId,anonymousOpenId:i,userId:r,uniqueId:o,gameVersion:a.gameVersion,sysInfo:t.getSystemStr(),logs:e};if(o){var c="".concat(H()).concat(W.REQ_LOGS);N.log.debug("log",s),N.network.post(c,s).catch(function(e){N.log.debug("log fail",e)})}},_delayReport:function(){var e=this;if(!this._delayer){var t=(N.global.platform.information.getConfig()||{}).logReportFrequency,n=void 0===t?5e3:t;this._delayer=setTimeout(function(){e._report(),e._delayer=null},n)}}};q._init();var Q={post:q.post.bind(q)},K=function(){return wx.getLaunchOptionsSync()},X=function(e){wx.onShow(e)},Y=function(e){wx.offShow(e)},J=function(e){wx.onHide(e)},z=function(e){wx.offHide(e)},Z=function(e){wx.onError(e)},$=function(e){wx.offError(e)};function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var te={_launchOptions:void 0,init:function(){N.eventBus.on(N.consts.EVT_ON_SHOW,this._onShown.bind(this)),Z(function(e){N.eventBus.dispatch(N.consts.EVT_ON_ERROR,e)})},launchOptions:function(){return this._launchOptions||this._parseLaunchOptions(K()),this._launchOptions},_onShown:function(e){var t=e.data;this._parseLaunchOptions(t)},_parseLaunchOptions:function(t){N.log.debug("onShow",t),this._launchOptions=function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ee(Object(r),!0).forEach(function(n){e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},t,{custom:this._buildCustomOptions(t)})},_buildCustomOptions:function(e){var t=(e||{}).query,n=void 0===t?{}:t,r={channel:n.channel||n.c||"hortor",origChannel:n.origChannel||"",shareConfigId:n.shareConfigId||"",activityId:n.activityId||"",h_shareCode:n.h_shareCode||"",pageQuery:n.scene||"",boxCode:n.wallCode||n.horwall||""},o=w.queryToJson(n.scene);return r.channel=o.channel||o.c||r.channel,r.origChannel=o.origChannel||r.origChannel,r.boxCode=o.wallCode||o.horwall||r.boxCode,r}},ne={canUse:function(e,t){var n=this.getSystemInfo().SDKVersion;return!(!wx[e]||!w.geVersion(n,t))},getSystemInfo:function(){return this.systemInfo||(this.systemInfo=wx.getSystemInfoSync(),this.systemInfo.hortorSDKVersion=x),this.systemInfo||{}},getSystemStr:function(){if(!this.systemInfoStr){var e=this.getSystemInfo();this.systemInfoStr=JSON.stringify({SDKVersion:e.SDKVersion,brand:e.brand,model:e.model,system:e.system,version:e.version,screenHeight:e.screenHeight,screenWidth:e.screenWidth,pixelRatio:e.pixelRatio,benchmarkLevel:e.benchmarkLevel,hortorSDKVersion:e.hortorSDKVersion})}return this.systemInfoStr},getNetStatus:function(){var e=this;return v(_.mark(function t(){return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.netStatus){t.next=6;break}return e.canUse("offNetworkStatusChange","2.8.1")&&w.defineProperty(wx,"offNetworkStatusChange",e._handleOffNetChange.bind(e)),e._onNetChange(),t.next=5,e.getNetworkType();case 5:e.netStatus=t.sent;case 6:return t.abrupt("return",e.netStatus);case 7:case"end":return t.stop()}},t)}))()},getNetworkType:function(){return new Promise(function(e,t){wx.getNetworkType({success:e,fail:t})})},onNetworkStatusChange:function(e){w.isFun(e)&&this.canUse("onNetworkStatusChange","1.1.0")&&wx.onNetworkStatusChange(e)},_onNetChange:function(){var e=this;this.onNetworkStatusChange(function(t){e.netStatus=t})},_handleOffNetChange:function(e){var t=this;return function(n){w.isFun(e)&&e(n),t._onNetChange()}},getNotchInfo:function(){var e=this.getSystemInfo(),t=e.screenHeight,n=void 0===t?0:t,r=e.screenWidth;return{result:n/(void 0===r?1:r)>2}}};te.init();var re={launchOptions:function(){return te.launchOptions()||{}},getConfig:function(){return U.sdkConfig()||{}},getNotchInfo:function(){return ne.getNotchInfo()},onShow:function(e){X(e)},offShow:function(e){Y(e)},onHide:function(e){J(e)},offHide:function(e){z(e)},onError:function(e){Z(e)},offError:function(e){$(e)}},oe={request:function(e,t,n,r,o){return new Promise(function(i,a){var s={url:t,method:e,data:n,header:r,responseType:o,success:function(e){i(e)},fail:function(e){a(e)}};wx.request(s)})}},ie={getStorage:function(e){try{return wx.getStorageSync(e)}catch(e){return null}},setStorage:function(e,t){if(w.isNull(t))return!1;try{return wx.setStorageSync(e,t),!0}catch(e){return!1}},removeStorage:function(e){try{return wx.removeStorageSync(e),!0}catch(e){return!1}},clearStorage:function(){try{return wx.clearStorageSync(),!0}catch(e){return!1}}};function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var se=function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ae(Object(r),!0).forEach(function(n){e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},{STG_LOGIN_INFO:"__sdk_login",STG_FAIL_LOGS:"__sdk_fail_logs",STG_STD_SEQ:"__sdk_std_seq",STG_SHARE_RULES:"__sdk_share_rules"},{},{ERR_GET_WXCODE_FAILED:{errCode:1001,errMsg:"微信Code获取失败"},ERR_WX_PAY_CANCEL:{errCode:1002,errMsg:"支付取消"},ERR_WX_PAY_FAILED:{errCode:1003,errMsg:"支付失败"},ERR_WX_AUTH_DENY:{errCode:1005,errMsg:"拒绝授权获取用户信息"},ERR_WX_NEED_AUTH:{errCode:1006,errMsg:"需要用户授权"},ERR_WX_GETINFO:{errCode:1007,errMsg:"获取用户信息失败"},ERR_WX_PAY_DATA_ERROR:{errCode:20002,errMsg:"订单数据不全，请传入创建订单返回的全部数据"},ERR_WX_CANT_UPDATE_SHARE:{errCode:20008,errMsg:"当前版本不支持使用动态分享"},ERR_WX_DUPLICATE_SHARE:{errCode:20009,errMsg:"频繁调用分享"},ERR_WX_GET_SHARE_FAIL:{errCode:20005,errMsg:"获取分享数据失败"},ERR_WX_NOT_SUPPORT:{errCode:3e4,errMsg:"方法暂不支持"},ERR_WX_PARAMS_ERROR:{errCode:30001,errMsg:"传参错误"},ERR_WX_NOT_LOGIN:{errCode:30002,errMsg:"未登录"},ERR_INSTANCE_DESTROYED:{errCode:30003,errMsg:"已销毁"},ERR_WX_TOO_SHARE_DURATION:{errCode:20013,errMsg:"录音时长太短"},ERR_WX_NO_AD:{errCode:1004,errMsg:"暂无广告"}},{},{REQ_LOGIN:"/ucenter-douyin-server/api/v1/login",REQ_TOP_VIDEOS:"/ucenter-douyin-server/api/v1/video/list",REQ_VIDEO_INFO:"/ucenter-douyin-server/api/v1/video",REQ_UPDATE_USER_INFO:"/ucenter-douyin-server/api/v1/user/update",REQ_SENSITIVE_MSG:"/ucenter-douyin-server/api/v1/sensitive/client",REQ_SHARE_INFO:"/mini/api/v1/shareinfo",REQ_SHARE_THEME:"/share/api/v1/scheme/all",REQ_QRCODE:"/mini/api/v1/minicode/create2",REQ_CANCEL_ORDER:"/mini/api/v1/order/cancel",REQ_PAY_CALLBACK:"/mini/api/v1/pay/callback",REQ_CERTIFICATION:"/common/api/v1/realname",REQ_SUBSCRIBE_SAVE:"/wxlog/api/v1/log/msg/subscribe",REQ_SUBSCRIBE_COUNT:"/wxlog/api/v1/log/msg/subscribe/num",REQ_CUSTOMERAPP:"/sdk/conf/api/v1/customer/get",REQ_AUDIO_GET_CREDIT:"/cos-server/api/v1/cos/tmpsts",REQ_STD_LOG:"/htlog/api/v1/log",REQ_STD_SCHEME:"/share_seq-server/api/v1/seq"},{},{LOGTP_SCENE:1,LOGTP_LOGIN:3,LOGTP_AUTH_DENY:10,LOGTP_MIDASHI_PAY_CALL:13,LOGTP_MIDASHI_PAY_SUCCESS:8,LOGTP_PAY_SUCCESS:9,LOGTP_PAY_ERROR:7,LOGTP_SHARE:2,LOGTP_SHARE_SHOW:19,LOGTP_SHARE_CALL:11,LOGTP_SHARE_SUCCESS:12,LOGTP_GAME_ZONE:14,LOGTP_VIDEO_AD_POINT_SHOW:20,LOGTP_VIDEO_AD_CLICK:15,LOGTP_VIDEO_AD_SHOW:16,LOGTP_VIDEO_AD_CLOSE:17,LOGTP_VIDEO_AD_EXIT:18,LOGTP_VIDEO_AD_LOAD:23,LOGTP_VIDEO_AD_LOADED:24,LOGTP_BANNER_AD_SHOW:28,LOGTP_BANNER_AD_SHOWED:21,LOGTP_BANNER_AD_HIDE:22,LOGTP_INTEREST_AD_SHOW:25,LOGTP_INTEREST_AD_SHOWED:26,LOGTP_INTEREST_AD_CLOSE:27,LOGTP_GAME_PORTAL_SHOW:29,LOGTP_GAME_PORTAL_SHOWED:30,LOGTP_GAME_PORTAL_CLOSE:31,LOGTP_GAME_BANNER_SHOW:32,LOGTP_GAME_BANNER_SHOWED:33,LOGTP_GAME_BANNER_HIDE:34,LOGTP_GAME_ICON_SHOW:35,LOGTP_GAME_ICON_SHOWED:36,LOGTP_GAME_ICON_HIDE:37,LOGTP_USER_CAPTURE_SCREEN:38,LOGTP_GRID_AD_SHOW:41,LOGTP_GRID_AD_SHOWED:42,LOGTP_GRID_AD_HIDE:43},{},{EVT_SESSION:"EVT_SESSION",EVT_WX_LOGIN:"EVT_WX_LOGIN",EVT_NEED_AUTH:"EVT_NEED_AUTH",EVT_ON_AUTH:"EVT_ON_AUTH",EVY_PAY_FAIL:"EVY_PAY_FAIL",EVT_SHARE_START:"EVT_SHARE_START",EVT_SHARE_END:"EVT_SHARE_END",EVT_SHARE_FRIEND:"EVT_SHARE_FRIEND",EVT_VIDEO_AD_PLAY_START:"EVT_VIDEO_AD_PLAY_START",EVT_VIDEO_AD_PLAY_FINISH:"EVT_VIDEO_AD_PLAY_FINISH",EVT_VIDEO_AD_ERROR:"EVT_VIDEO_AD_ERROR"},{},{STATUES_SHARING:"sharing"},{},{COM_SHARE_RESULT:{SUC:"success",FAIL:"fail",AUTO:void 0}}),ce=function(){var e=re.getConfig(),t=e.gameId,n=e.env;return"".concat(se.STG_LOGIN_INFO,"_").concat(t,"_").concat(n)},ue=void 0,fe=function(){return void 0===ue&&(N.log.debug("get login storage",ce()),ue=N.storage.get(ce(),null)),ue},he=void 0,ge={},de={clearUserInfo:function(){return ue=null,N.storage.remove(ce())},getUserInfo:function(e){var t=fe()||{},n=t.userInfo,r=t.saveTime;if(!n||!r)return null;var o=((n||{}).userSdk||{}).hasUserInfo;if(!e&&!o)return null;var i=re.getConfig().expireTime||86400,a=w.getTimeSec();return r+i<a||r>a?null:n},setUserInfo:function(e){var t=e||{},n=t.encryptUserInfo,r=t.userSdk;if(!n)return!1;var o={userInfo:e,saveTime:w.getTimeSec()};N.storage.set(ce(),o),o.userInfo=Object.assign(e,{userSdk:this._inheritOldData(r)}),ue=o},_inheritOldData:function(e){var t=this.getTempUser();if(!t||!e)return e;var n=t.isNewUser;return w.isNull(n)||(e.isNewUser=!!n),e},getSDKUserInfo:function(){var e=((fe()||{}).userInfo||{}).userSdk;return e&&(e.gameUser=this.getGameUser()),e},setTempUser:function(e){var t=(e||{}).userSdk;he=t?this._inheritOldData(t):null},getTempUser:function(){if(!he){var e=((fe()||{}).userInfo||{}).userSdk;he=e||null}return he},setGameUser:function(e){ge=Object.assign(ge,e),N.eventBus.dispatch(N.consts.EVT_SET_GAMEUSER,ge)},getGameUser:function(){return ge}},pe={_isShowed:!1,_isLaunched:!1,_sdkInited:!1,_hideAt:0,init:function(){X(this._handleOnShow.bind(this)),J(this._handleOnHide.bind(this)),N.eventBus.once(N.consts.EVT_SDK_READY,this._onSDKInit.bind(this),-1)},_onSDKInit:function(){var e=this;this._sdkInited=!0,this._isShowed?this._triggerOnShow():setTimeout(function(){e._isShowed||e._triggerOnShow()},2e3)},_triggerOnShow:function(){var e=K();this._handleOnShow(e)},_handleOnShow:function(e){var t=this._hideAt?Date.now()-this._hideAt:0;e.hideDuration=t,this._isShowed=!0,e.coldStart=!this._isLaunched,N.eventBus.dispatch(N.consts.EVT_ON_SHOW,e),this._sdkInited&&(this._isLaunched=!0)},_handleOnHide:function(e){this._hideAt=Date.now(),N.eventBus.dispatch(N.consts.EVT_ON_HIDE,e)}},_e={network:oe,storage:ie,information:{getUserInfo:function(){return de.getSDKUserInfo()},getSystemStr:function(){return ne.getSystemStr()},getSystemInfo:function(){return ne.getSystemInfo()},getNetStatus:function(){return ne.getNetStatus()},getLaunchOpts:function(){return re.launchOptions()},getConfig:function(){return re.getConfig()}}};N.global.platform=_e,pe.init();var le={init:function(e){return V(e)}},ve={AggrType:{SWITCH:"customSwitch",IP_REGION:"ipregion",SHARE:"share"},post:function(e){var t=this;return v(_.mark(function n(){var r,o,i,a,s,c,u,f,h,g,d,p,l,v;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=U.sdkConfig(),o=r.gameId,i=r.gameVersion,a=N.global.platform.information,s=a.getUserInfo()||{},c=s.uniqueId,u=s.userId,f=s.name,h=a.getSystemStr(),n.next=6,N.procCenter.process(N.consts.PROC_PRE_AGGR,e);case 6:return g=n.sent,d=Object.keys(g),p={gameId:o,gameVersion:i,openId:u,uniqueId:c,userId:c,servers:d,nickName:f||"",params:g,sysInfo:h},l="".concat(B()).concat(W.REQ_AGGREGATION),n.next=12,N.network.post(l,p);case 12:return v=n.sent,n.next=15,t._renderResult(v.data,g);case 15:return n.abrupt("return",n.sent);case 16:case"end":return n.stop()}},n)}))()},_renderResult:function(e,t){return v(_.mark(function n(){var r,o,i;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e||{},o={},Object.keys(r).forEach(function(e){var t={data:null,err:null},n=r[e]||{},i=n.data,a=n.meta;a&&a.errCode?t.err=a:t.data=i,o[e]=t}),n.next=5,N.procCenter.process(N.consts.PROC_REQ_AGGR,{req:t,resp:o});case 5:return i=n.sent,n.abrupt("return",Object.assign(o,i));case 7:case"end":return n.stop()}},n)}))()}},me=function(){return ve.AggrType},Ee=function(e){return ve.post(e)},Oe={getAggregationTypes:function(){return me()},aggregationRequest:function(e){Ee(e.params).then(function(t){e.success&&e.success(t)}).catch(function(t){e.fail&&e.fail(t)})}},Se={init:function(){N.procCenter.register(N.consts.PROC_PRE_AGGR,this._processAggr.bind(this)),N.procCenter.register(N.consts.PROC_REQ_AGGR,this._processAggrReq.bind(this))},_renderSwitches:function(e){var t=[];return e.map(function(e){if(e){var n="string"==typeof e?e:e.switchId;t.some(function(e){return e.switchId===n})||t.push({switchId:n})}}),t},_renderParams:function(e){var t={};if(e)for(var n in e){var r=e[n];void 0!==r&&"nickName"!==n&&(t[n]=r)}return t},_getRequestData:function(e,t){var n=(t||{}).nickName,r=N.global.platform.information,o=r&&r.getUserInfo()||{},i=o.userId,a=o.uniqueId,s=o.name,c=o.channel,u=r&&r.getLaunchOpts()||{},f=u.scene,h=u.custom.channel,g=U.sdkConfig();return{gameId:g.gameId,gameVersion:g.gameVersion,nickName:n||s||"",uniqueId:a,channel:c,openId:i,scene:Number(f),currentChannel:h,defCustomParams:this._renderParams(t),switches:this._renderSwitches(e)}},_transformResult:function(e,t){var n=(e||{}).rlt,r=void 0===n?[]:n,o={};return t.map(function(e,t){o[e.switchId]=!!r[t]}),N.log.debug("switch result",o),o},_processAggr:function(e){if(!e||!e.customSwitch)return null;var t=e.customSwitch,n=t.switches,r=t.params;return{customSwitch:this._getRequestData(n,r)}},_processAggrReq:function(e){if(!(e&&e.resp&&e.req&&e.req.customSwitch&&e.resp.customSwitch))return null;var t=e.req.customSwitch.switches,n=e.resp.customSwitch.data;return{customSwitch:{data:this._transformResult(n,t)}}},check:function(e,t){var n=this;return v(_.mark(function r(){var o,i,a;return _.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o="".concat(B()).concat(W.REQ_SWITCH),i=n._getRequestData(e,t),r.next=4,N.network.post(o,i);case 4:return a=r.sent,r.abrupt("return",n._transformResult(a.data,i.switches));case 6:case"end":return r.stop()}},r)}))()}};Se.init();var Te={checkSwitches:function(e,t){return Se.check(e,t)}},Ie={init:function(){N.procCenter.register(N.consts.PROC_PRE_AGGR,this._processAggr.bind(this))},checkIps:function(e){return v(_.mark(function t(){var n,r,o,i,a,s,c,u,f,h,g;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.interfaceIds,r=e.userId,o=U.sdkConfig(),i=o.gameId,a=o.gameVersion,s=N.global.platform.information,c=s.getUserInfo()||{},u=c.uniqueId,f={gameId:i,gameVersion:a,interfaceIds:n||[],userId:r||u},h="".concat(B()).concat(W.REQ_IPS_CHECK),t.next=8,N.network.post(h,f);case 8:return g=t.sent,t.abrupt("return",g.data);case 10:case"end":return t.stop()}},t)}))()},_processAggr:function(e){if(!e||!e.ipregion)return null;var t=(N.global.platform.information.getUserInfo()||{}).uniqueId,n=Object.assign({},e.ipregion);return e.ipregion.userId||(n=Object.assign(n,{userId:t||""})),{ipregion:n}}};Ie.init();var ye=function(e){return Ie.checkIps(e)},we={checkIP:function(e,t){this.checkIPs({interfaceIds:[e],callback:function(n){var r=(n||{}).result;t&&t(!!(void 0===r?{}:r)[e])}})},checkIPs:function(e){var t=e.interfaceIds,n=e.userId,r=e.callback;ye({interfaceIds:t,userId:n}).then(function(e){r&&r(e)}).catch(function(e){r&&r(null,e)})}},be={Text:1,Image:2,Scroll:4},Re=be.Text|be.Image,Ae={NoticeTypes:be,getNotice:function(e){return v(_.mark(function t(){var n,r,o,i,a;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=U.sdkConfig(),r=n.gameId,o=Object.assign({},{gameId:r,tp:Re},e||{}),i="".concat(B()).concat(W.REQ_NOTICES),t.next=5,N.network.get(i,o);case 5:return a=t.sent,t.abrupt("return",a.data);case 7:case"end":return t.stop()}},t)}))()}},De=function(e){return Ae.getNotice(e)},Le={getNotice:function(e,t){"function"==typeof e&&(t=e,e={}),"function"==typeof t&&De(e).then(function(e){t(e,null)}).catch(function(e){t(null,e)})}},Ne=function(){return v(_.mark(function e(){var t,n,r,o,i,a,s,c;return _.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=U.sdkConfig(),n=t.gameId,r=N.global.platform.information,o=r.getUserInfo()||{},i=o.uniqueId,a={userId:i,gameId:n},s="".concat(B()).concat(W.REQ_EXT_USER_INFO),e.next=7,N.network.get(s,a);case 7:return c=e.sent,e.abrupt("return",c.data);case 9:case"end":return e.stop()}},e)}))()},xe=function(){return Ne()},ke={getExtUserInfo:function(e){e&&xe().then(function(t){e(t,null)}).catch(function(t){e(null,t)})}},Pe={postLog:function(e,t){return Q.post(e,t)}},Ce={ERROR:"error",WARN:"warn",DEBUG:"debug"},Ue={LOG_TP:Ce,init:function(){var e=this;N.eventBus.on(N.consts.EVT_LOGIN_FAIL,function(t){e.postLog(Ce.ERROR,t.data)}),N.eventBus.on(N.consts.EVT_ON_ERROR,function(t){e.postLog(Ce.ERROR,t.data)})},postLog:function(e,t,n){t&&"object"===I(t)&&!n&&(n=t,t="");var r=n||{},o=r.msg,i=r.errMsg,a=r.message,s=r.logTp,c=t||o||a||i;N.log.debug("".concat(e,": ").concat(c),n);var u=N.global.platform.information,f=u.getUserInfo()||{},h=f.userId,g=f.uniqueId,d=u.getConfig(),p=d.gameId,_=d.gameVersion,l=u.getSystemStr(),v=Object.assign({msg:c,logTp:s,gameId:p,gameVersion:_,userId:h,uniqueId:g,sysInfo:l,hortorMsg:c,hortorLogTp:e},n||{}),m="".concat(B()).concat(W.REQ_REMOTE_LOG);N.network.post(m,v).catch(function(e){N.log.debug("post remote log fail",e)})}};Ue.init();var Ve={debugLog:function(e,t){Ue.postLog(Ue.LOG_TP.DEBUG,e,t)},warnLog:function(e,t){Ue.postLog(Ue.LOG_TP.WARN,e,t)},errorLog:function(e,t){Ue.postLog(Ue.LOG_TP.ERROR,e,t)}},Ge={launchOptions:function(){return re.launchOptions()},windowOnError:function(e){re.onError(e)},isNotchMobile:function(){return re.getNotchInfo()}},je={canUserInfoBtn:ne.canUse("createUserInfoButton","2.0.1"),createUserInfoButton:function(e){return this.canUserInfoBtn?wx.createUserInfoButton(Object.assign({},{lang:"zh_CN"},e)):null},checkSession:function(){return new Promise(function(e,t){wx.checkSession({success:e,fail:t})})},wxLogin:function(e){return new Promise(function(t,n){wx.login({force:e,success:function(e){e.code||e.anonymousCode?t(e):n(se.ERR_GET_WXCODE_FAILED)},fail:n})})},checkAuthorize:function(){return new Promise(function(e,t){wx.getSetting({success:function(t){e(t.authSetting["scope.userInfo"])},fail:t})})},getUserInfo:function(){return new Promise(function(e,t){wx.getUserInfo({withCredentials:!0,lang:"zh_CN",success:function(n){if((n||{}).encryptedData)return e(n);t(se.ERR_WX_GETINFO)},fail:t})})},authorize:function(){return new Promise(function(e,t){wx.authorize({scope:"scope.userInfo",success:function(){e(!0)},fail:t})})},toSetting:function(){return new Promise(function(e,t){wx.openSetting({success:function(t){e(t.authSetting["scope.userInfo"])},fail:t})})},getUserGameLabel:function(){return new Promise(function(e,t){ne.canUse("getUserGameLabel","2.9.3")?wx.getUserGameLabel({success:e,fail:t}):t(se.ERR_WX_NOT_SUPPORT)})}},Me=function(e){return new Promise(function(t,n){wx.showModal(Object.assign({success:t,fail:n},e))})},Be={setGameUser:function(e){de.setGameUser(e)},registerOnLogin:function(e){N.eventBus.on(N.consts.EVT_ON_LOGIN,e)},login:function(e,t){var n=this;return v(_.mark(function r(){var o;return _.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return N.eventBus.dispatch(N.consts.EVT_LOGIN_START),r.next=3,n._login(e,t,!1);case 3:return o=r.sent,n._postLog(se.LOGTP_LOGIN),N.eventBus.dispatch(N.consts.EVT_ON_LOGIN,o),r.abrupt("return",o.encryptUserInfo);case 7:case"end":return r.stop()}},r)}))()},update:function(e){var t=this;return v(_.mark(function n(){var r;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return N.eventBus.dispatch(N.consts.EVT_UPDATE_START),n.next=3,t._login(e,!1,!0);case 3:return r=n.sent,t._postLog(se.LOGTP_LOGIN),N.eventBus.dispatch(N.consts.EVT_ON_UPDATE,r),n.abrupt("return",r.encryptUserInfo);case 7:case"end":return n.stop()}},n)}))()},createUserInfoBtn:function(e){var t=this,n=re.getConfig().getUserInfoBtn,r=je.createUserInfoButton(e||n);return r&&r.onTap(function(e){var n=e||{},r=n.userInfo,o=n.encryptedData,i=r||{},a=i.nickName,s=i.gender;a&&N.eventBus.dispatch(se.EVT_ON_AUTH,{nickName:a,gender:s}),o||t._postLog(se.LOGTP_AUTH_DENY)}),r},checkAuth:function(){return v(_.mark(function e(){return _.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!je.canUserInfoBtn){e.next=7;break}return e.next=4,je.checkAuthorize();case 4:return e.abrupt("return",e.sent);case 7:return e.next=9,je.authorize();case 9:return e.abrupt("return",e.sent);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),N.log.debug("checkAuth fail",e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,null,[[0,12]])}))()},_login:function(e,t,n){var r=this;return v(_.mark(function o(){var i,a,s,c,u,f,h,g,d,p,l,v,m,E,O,S,T,I;return _.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,r._getStorage(t,n);case 3:if(i=o.sent,a=re.getConfig(),s=a.gameId,c=(e||{}).isForce,u=void 0!==c&&c,!i){o.next=11;break}if(!(f=i.userSdk)||f.gameId!==s){o.next=11;break}return N.log.debug("storageInfo",i),o.abrupt("return",i);case 11:return o.next=13,r._wxlogin(u);case 13:return h=o.sent,o.next=16,r._entry(h,t,n);case 16:if(g=o.sent,!(d=(g||{}).userSdk)||!d.isAuth){o.next=20;break}return o.abrupt("return",g);case 20:return o.next=22,r._fetchUserInfo(e);case 22:return(p=o.sent)&&p.userInfo&&(l=p.userInfo||{},v=l.nickName,m=l.gender,E=l.avatarUrl,O=l.city,S=l.country,T=l.language,I=l.province,v&&N.eventBus.dispatch(se.EVT_ON_AUTH,{nickName:v,gender:m,avatarUrl:E,city:O,country:S,language:T,province:I})),o.next=26,r._postUserInfo(p);case 26:return o.abrupt("return",o.sent);case 29:throw o.prev=29,o.t0=o.catch(0),w.pkgError(o.t0,N.consts.ERR_UNKNOWN);case 32:case"end":return o.stop()}},o,null,[[0,29]])}))()},_getStorage:function(e,t){var n=this;return v(_.mark(function r(){var o,i;return _.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=2;break}return r.abrupt("return",null);case 2:if(o=de.getUserInfo(e)){r.next=5;break}return r.abrupt("return",null);case 5:return r.next=7,n._checkSession();case 7:return i=r.sent,r.abrupt("return",i?o:null);case 9:case"end":return r.stop()}},r)}))()},_checkSession:function(){return v(_.mark(function e(){return _.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,je.checkSession();case 3:return N.eventBus.dispatch(se.EVT_SESSION,{}),e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(0),N.log.warn("session fail",e.t0),N.eventBus.dispatch(se.EVT_SESSION,{err:e.t0}),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[0,7]])}))()},_wxlogin:function(e){return v(_.mark(function t(){var n;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,je.wxLogin(e);case 3:return n=t.sent,N.eventBus.dispatch(se.EVT_WX_LOGIN,{code:n}),t.abrupt("return",n);case 8:throw t.prev=8,t.t0=t.catch(0),N.eventBus.dispatch(se.EVT_WX_LOGIN,{err:t.t0}),w.pkgError(t.t0,se.ERR_GET_WXCODE_FAILED);case 12:case"end":return t.stop()}},t,null,[[0,8]])}))()},_entry:function(e,t,n){var r=this;return v(_.mark(function o(){var i,a,s,c,u,f,h,g,d,p,l,v,m,E,O,S,T,I,y,b,R;return _.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i=re.getConfig(),a=i.gameId,s=re.launchOptions(),c=s.custom,u=s.query,h=(f=e||{}).code,g=f.anonymousCode,d=f.isLogin,l=(p=c||{}).channel,v=p.origChannel,m=p.pageQuery,E=p.shareConfigId,O=p.activityId,S=p.h_shareCode,T=p.boxCode,I={anonymousCode:g,isLogin:d,code:h,gameId:a,channel:l,origChannel:v,shareConfigId:E,activityId:O,h_shareCode:S,boxCode:T,isWeak:t,forceAuth:n,version:x,query:m,queryRaw:JSON.stringify(u),sysInfo:ne.getSystemStr()},o.prev=5,y="".concat(M()).concat(se.REQ_LOGIN),o.next=9,N.network.post(y,I);case 9:return b=o.sent,R=b.data,N.log.debug("entry login",R),r._setUserInfo(R),de.setTempUser(R),o.abrupt("return",R);case 17:throw o.prev=17,o.t0=o.catch(5),N.log.warn("entry err",o.t0),de.clearUserInfo(),w.pkgError(o.t0,N.consts.ERR_NET_FAIL);case 22:case"end":return o.stop()}},o,null,[[5,17]])}))()},_fetchUserInfo:function(e){var t=this;return v(_.mark(function n(){var r;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=null,!je.canUserInfoBtn){n.next=7;break}return n.next=4,t._highVGetUserInfo(e);case 4:r=n.sent,n.next=10;break;case 7:return n.next=9,t._lowVGetUserInfo();case 9:r=n.sent;case 10:return N.log.debug("fetch userinfo",r),n.abrupt("return",r);case 12:case"end":return n.stop()}},n)}))()},_postUserInfo:function(e){var t=this;return v(_.mark(function n(){var r,o,i,a,s,c,u,f,h,g,d,p,l,v;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=(r=e||{}).encryptedData,i=r.iv,a=r.rawData,s=r.signature,c=de.getTempUser()||{},u=c.userId,f=c.uniqueId,h=re.getConfig(),g=h.gameId,d={signature:s,entryAlias:"minisdk",gameId:g,userId:u,uniqueId:f,encryptedData:o,rawData:a,iv:i},n.prev=4,p="".concat(M()).concat(se.REQ_UPDATE_USER_INFO),n.next=8,N.network.post(p,d);case 8:if(l=n.sent,(v=l.data)&&v.encryptUserInfo){n.next=12;break}throw N.consts.ERR_NET_FAIL;case 12:return t._setUserInfo(v),n.abrupt("return",v);case 16:throw n.prev=16,n.t0=n.catch(4),N.log.warn("_postUserInfo err",n.t0),w.pkgError(n.t0,N.consts.ERR_NET_FAIL);case 20:case"end":return n.stop()}},n,null,[[4,16]])}))()},_highVGetUserInfo:function(e){var t=this;return v(_.mark(function n(){var r,o,i,a,s,c;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.checkAuth();case 2:if(!n.sent){n.next=9;break}return n.next=6,t._getUserInfo();case 6:n.t0=n.sent,n.next=10;break;case 9:n.t0=null;case 10:if(!(r=n.t0)){n.next=13;break}return n.abrupt("return",r);case 13:if(N.eventBus.dispatch(se.EVT_NEED_AUTH),o=re.getConfig(),i=o.getUserInfoBtn,s=(a=e||{}).useGameBtn,c=a.config,!s&&(c||i)){n.next=18;break}throw se.ERR_WX_NEED_AUTH;case 18:return n.next=20,t._highVGetAuth(e);case 20:return n.abrupt("return",n.sent);case 21:case"end":return n.stop()}},n)}))()},_getUserInfo:function(){return v(_.mark(function e(){return _.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,je.getUserInfo();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:case"end":return e.stop()}},e,null,[[0,6]])}))()},_setUserInfo:function(e){var t=e||{},n=t.encryptUserInfo,r=t.userSdk,o=re.getConfig().gameId;n&&(this._postScene(),r&&(r.gameId=o),de.setUserInfo(e))},_highVGetAuth:function(e){var t=this,n=e||{},r=n.config,o=n.onTap,i=n.onShow,a=n.stayOnDeny;return new Promise(function(e,n){var s=t._getOnlyBtn(r);if(!s)throw se.ERR_WX_NOT_SUPPORT;s.onTap(function(r){var i=(r||{}).encryptedData;i?e(r):a||n(se.ERR_WX_AUTH_DENY),o&&o(r),!i&&a||t._removeOnlyBtn()}),s.show(),i&&i()})},_getOnlyBtn:function(e){return this._removeOnlyBtn(),this.authBtn=this.createUserInfoBtn(e),this.authBtn},_removeOnlyBtn:function(){this.authBtn&&(this.authBtn.hide(),this.authBtn.destroy(),this.authBtn=null)},_lowVGetUserInfo:function(){var e=this;return v(_.mark(function t(){var n;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.checkAuth();case 2:if(n=t.sent){t.next=8;break}return N.eventBus.dispatch(se.EVT_NEED_AUTH),t.next=7,e._lowVGetAuth();case 7:n=t.sent;case 8:if(n){t.next=10;break}throw se.ERR_WX_AUTH_DENY;case 10:return t.next=12,je.getUserInfo();case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}},t)}))()},_lowVGetAuth:function(){var e=this;return v(_.mark(function t(){var n;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,je.toSetting();case 3:if(!t.sent){t.next=6;break}return t.abrupt("return",!0);case 6:return t.next=8,Me({title:"提示",content:"需要开启访问用户信息权限",showCancel:!0,cancelText:"知道了",confirmText:"去设置"});case 8:if(n=t.sent,n.confirm){t.next=12;break}return t.abrupt("return",!1);case 12:return t.next=14,e._lowVGetAuth();case 14:return t.abrupt("return",t.sent);case 17:return t.prev=17,t.t0=t.catch(0),N.log.debug("low auth fail",t.t0),t.abrupt("return",!1);case 21:case"end":return t.stop()}},t,null,[[0,17]])}))()},_postLog:function(e,t){var n=de.getTempUser()||{},r=n.userId,o=n.uniqueId,i=re.launchOptions(),a=i.custom,s=i.scene,c=a||{},u={logType:e,channel:c.channel,origChannel:c.origChannel,scene:s,userId:r,uniqueId:o},f=t?Object.assign(u,t):u;N.eventBus.dispatch(N.consts.EVT_REPORT_LOG,{log:f})},_postScene:function(){if(!de.getUserInfo(!0)){var e=re.launchOptions()||{},t=e.custom||{},n=t.shareConfigId,r=t.activityId,o=w.copy(e,["custom"]);this._postLog(se.LOGTP_SCENE,{content:o,shareConfigId:n,activityId:r})}}},He={createGetUserInfoBtn:function(e){return Be.createUserInfoBtn(e)},login:function(e){return Be.login(e,!1)},weakLogin:function(e){return Be.login(e,!0)},updateUserInfo:function(e){return Be.update(e)},registerOnLogin:function(e){Be.registerOnLogin(e)},getGetUserInfoBtn:function(e){return Be.authBtn&&!e?Be.authBtn:Be._getOnlyBtn(e)},setGameUserInfo:function(e){Be.setGameUser(e)}},Fe={_canUseVideo:ne.canUse("createRewardedVideoAd","1.3.0"),_canUseMultiVideo:ne.canUse("createRewardedVideoAd","2.8.0"),createRewardedVideoAd:function(e){return this._canUseVideo?wx.createRewardedVideoAd(e):null}},We=function(e,t){var n=re.launchOptions(),r=n.scene,o={adUnitId:e,logType:t,channel:(n.custom||{}).channel,scene:r};N.eventBus.dispatch(N.consts.EVT_REPORT_LOG,{log:o})};function qe(){var e=re.getConfig(),t=e.videoCoolTime,n=e.videoTimeout;this.adInstance=void 0,this.loaded=!1,this.loading=!0,this.loadReported=!1,this.coolLoad=!1,this.coolTimer=null,this.loadCoolTime=t||18e4,this.callTimeout=n||5e3,this.destroyed=!1,this.fstLoaded=!1}qe.prototype={_sCool:function(){this.coolLoad=!1,this.coolTimer=null},_sRest:function(){this.loaded=!1,this.loading=!0,this._sCool()},_sLoad:function(e){N.log.debug("ad loaded",e),this.loaded=!0,this.loading=!1,this.fstLoaded=!0,this._sCool()},_sError:function(e){N.log.debug("ad err",e),this.loaded=!1,this.loading=!1,this.fstLoaded=!0;var t=e.errCode;!this.coolTimer&&[1002,1004].indexOf(t)>-1&&(this.coolLoad=!0,this.coolTimer=setTimeout(this._sCool.bind(this),this.loadCoolTime))},_loadAd:function(e,t){var n=this;return v(_.mark(function r(){return _.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(N.log.debug("ad reload"),r.prev=1,!n.coolLoad||!t){r.next=4;break}throw t;case 4:return r.next=6,e.load();case 6:return n._sLoad(),r.abrupt("return",!0);case 10:throw r.prev=10,r.t0=r.catch(1),n._sError(r.t0),r.t0;case 14:case"end":return r.stop()}},r,null,[[1,10]])}))()},_showAd:function(e){var t=this;return v(_.mark(function n(){return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return N.log.debug("ad show"),n.prev=1,n.next=4,e.show();case 4:return n.abrupt("return",n.sent);case 7:return n.prev=7,n.t0=n.catch(1),n.next=11,t._loadAd(e,n.t0);case 11:return n.abrupt("return",e.show());case 12:case"end":return n.stop()}},n,null,[[1,7]])}))()},_waitResult:function(e){var t=this;return N.log.debug("ad wait"),new Promise(function(n,r){var o=setTimeout(function(){if(N.log.debug("ad wait timeout"),t.fstLoaded)return t._sLoad("fake"),n(!0);t._loadAd(e).then(n).catch(r)},t.callTimeout);e.onLoad(function(t){e.offLoad(this),clearTimeout(o),n(!0)}),e.onError(function(t){e.offError(this),clearTimeout(o),r(t)})})},getInstance:function(e){if(void 0!==this.adInstance)return this.adInstance;var t=Fe.createRewardedVideoAd(e);return this.adInstance=t,t?(t.onLoad(this._sLoad.bind(this)),t.onError(this._sError.bind(this)),this.adInstance):null},_getAdInstance:function(e){var t=this;return v(_.mark(function n(){var r;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.destroyed){n.next=2;break}throw se.ERR_INSTANCE_DESTROYED;case 2:if(r=t.getInstance(e)){n.next=5;break}throw se.ERR_WX_NOT_SUPPORT;case 5:return n.abrupt("return",r);case 6:case"end":return n.stop()}},n)}))()},_checkLoaded:function(e){var t=this;return v(_.mark(function n(){return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.loaded){n.next=2;break}return n.abrupt("return",!0);case 2:if(!t.loading){n.next=6;break}return n.next=5,t._waitResult(e);case 5:return n.abrupt("return",n.sent);case 6:if(t.coolLoad){n.next=11;break}return N.log.debug("ad try load"),n.next=10,t._loadAd(e);case 10:return n.abrupt("return",n.sent);case 11:if(t.loaded){n.next=13;break}throw se.ERR_WX_NO_AD;case 13:return n.abrupt("return",!0);case 14:case"end":return n.stop()}},n)}))()},destroy:function(){this.adInstance&&(this.adInstance.destroy(),this.adInstance=null),this.destroyed=!0,this._sRest(),this.loading=!1},_showStart:function(e){this.loadReported=!1,N.eventBus.dispatch(se.EVT_VIDEO_AD_PLAY_START,{adUnitId:e})},_showSuccess:function(e){N.eventBus.dispatch(se.EVT_VIDEO_AD_PLAY_START,{adUnitId:e,playSuccess:!0})},_showFinish:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,i=r?Math.max(w.getTime()-r,0):0;N.eventBus.dispatch(se.EVT_VIDEO_AD_PLAY_FINISH,{adUnitId:e,isEnded:t,playFailCode:n,spentTime:i,sequenceInfo:o})},show:function(e){var t=this;return v(_.mark(function n(){var r,o,i,a,s,c,u,f,h,g;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._getAdInstance(e);case 2:return r=n.sent,o=e.adUnitId,i=e.onClose,a=e.sequenceInfo,N.log.debug("showing ad",o),s=w.getTime(),c=function e(n){r.offClose(e),i&&i(n);var c=(n||{}).isEnded,u=void 0===c||c;We(o,u?se.LOGTP_VIDEO_AD_CLOSE:se.LOGTP_VIDEO_AD_EXIT),t._showFinish(o,u,0,s,a)},r.onClose(c),We(o,se.LOGTP_VIDEO_AD_CLICK),t._showStart(o),n.prev=10,n.next=13,t._checkLoaded(r);case 13:return n.next=15,t._showAd(r);case 15:return u=n.sent,t._showSuccess(o),t._sRest(),We(o,se.LOGTP_VIDEO_AD_SHOW),n.abrupt("return",u);case 22:throw n.prev=22,n.t0=n.catch(10),r.offClose(c),f=n.t0||{},h=f.errCode,g=void 0===h?1:h,t._showFinish(o,!1,g,s,a),N.log.debug("ad show err",o,n.t0),N.eventBus.dispatch(se.EVT_VIDEO_AD_ERROR,{adUnitId:o,err:n.t0}),n.t0;case 30:case"end":return n.stop()}},n,null,[[10,22]])}))()},check:function(e){var t=this;return v(_.mark(function n(){var r,o,i;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._getAdInstance(e);case 2:return r=n.sent,o=e.adUnitId,N.log.debug("checking ad",o),t.loadReported||We(o,se.LOGTP_VIDEO_AD_LOAD),n.prev=6,n.next=9,t._checkLoaded(r);case 9:return i=n.sent,t.loadReported||We(o,se.LOGTP_VIDEO_AD_LOADED),n.abrupt("return",i);case 14:throw n.prev=14,n.t0=n.catch(6),N.log.debug("ad check err",o,n.t0),N.eventBus.dispatch(se.EVT_VIDEO_AD_ERROR,{adUnitId:o,err:n.t0}),n.t0;case 19:return n.prev=19,t.loadReported=!0,n.finish(19);case 22:case"end":return n.stop()}},n,null,[[6,14,19,22]])}))()}};var Qe={managerOrder:[],adManagers:{},idToManagerKeys:{},_getOpt:function(e){var t=Object.assign({},e),n=t.multiton,r=t.type;return t.multiton=!(!n&&!r||!Fe._canUseMultiVideo),t},_getManagerKey:function(e){var t=e.adUnitId,n=this.idToManagerKeys[t];return n||(this.idToManagerKeys[t]="global","global")},_getAdManager:function(e){var t=this._getManagerKey(e),n=this.adManagers[t]||null;if(n)return n;var r=re.getConfig().maxTempVideoAdLen;this.managerOrder.length>=r&&this.destroy(this.managerOrder[0]);var o=e.adUnitId,i=new qe;return N.log.debug("create adManager",t,o),this.adManagers[t]=i,this.managerOrder.push(t),this.idToManagerKeys[o]=t,i},destroy:function(e){var t="";if((t="string"==typeof e?this.idToManagerKeys[e]||e||"":e?this._getManagerKey(this._getOpt(e)):"")&&"global"!==t){var n=this.adManagers[t];if(n){n.destroy(),this.adManagers[t]=null;var r=this.managerOrder.indexOf(t);r>-1&&this.managerOrder.splice(r,1),N.log.debug("destroy adManager",t)}}},check:function(e){var t=this;return v(_.mark(function n(){var r;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t._getAdManager(e),n.next=3,r.check(e);case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}},n)}))()},show:function(e){var t=this;return v(_.mark(function n(){var r,o;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t._getOpt(e),o=t._getAdManager(r),n.next=4,o.show(r);case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}},n)}))()},play:function(e){var t=this;return new Promise(function(n,r){var o=(e||{}).onShow;t.show(Object.assign({},e||{},{onClose:function(e){n(e||{isEnded:!0})}})).then(function(e){o&&o(e)}).catch(r)})},getVideoAd:function(e){var t=this._getOpt(e);return this._getAdManager(t).getInstance(t)},adPointShow:function(e){We(e,se.LOGTP_VIDEO_AD_POINT_SHOW)}},Ke={adPointShow:function(e){Qe.adPointShow(e)},checkVideoAd:function(e){return Qe.check(e)},showVideoAd:function(e){return Qe.show(e)},playVideoAd:function(e){return Qe.play(e)},destroyVideoAd:function(e){Qe.destroy(e)},getVideoAd:function(e){return Qe.getVideoAd(e)}},Xe={},Ye=function(e,t){Xe[e]=t},Je=function(e){return!!Xe[e]};function ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.lastIndex=-1,this.allZero=!1,this.allWeight=0,this.unitWeight=100,this.opt=e,this._init()}ze.prototype={_init:function(){var e=this.opt,t=e.list,n=e.lastIndex,r=e.weightCount;if(t&&t.length){this.lastIndex="number"==typeof n?n:-1;var o=0;"number"==typeof r?o=r:t.map(function(e){var t=e.weight;o+=(void 0===t?0:t)-0}),0===o&&(this.allZero=!0,o=t.length*this.unitWeight),this.allWeight=o}},_setLastIndex:function(e){this.lastIndex=e},_getLastIndex:function(){return this.lastIndex},_getRandomIndex:function(){var e=this,t=this.opt.list,n=Math.floor(Math.random()*this.allWeight),r=0;return t.findIndex(function(t){var o=e.allZero?e.unitWeight:t.weight,i=!!(r<=n&&n<r+o);return i||(r+=o),i})},_getUniqueIndex:function(){var e=this._getLastIndex(),t=this._getRandomIndex();return t!==e?(this._setLastIndex(t),t):this._getUniqueIndex()},getIndex:function(){var e=-1;switch(this.opt.list.length){case 0:e=-1;break;case 1:e=0;break;default:e=this._getUniqueIndex()}return e},getData:function(){var e=(this.opt||{}).list;return(void 0===e?[]:e)[this.getIndex()]}};var Ze={_renderQuery:function(e){var t=e||{},n=t.query,r=t.shareConfigId,o=t.activityId,i=t.shareGuid,a=w.getTimeSec(),s=de.getSDKUserInfo()||{},c=s.h_shareCode,u=void 0===c?"":c,f=s.channel,h=void 0===f?"hortor_":f,g=s.origChannel,d=void 0===g?"":g,p={channel:w.endsWith(h,"_")?h:"".concat(h,"_"),h_shareCode:u,timestamp:a,origChannel:d,shareConfigId:r,activityId:o,share_guid:i};return w.addToQuery(n,p)},_renderTitle:function(e){var t=e||{},n=t.title,r=t.titleParams;if(!n)return"";r&&"object"===I(r)&&Object.keys(r).forEach(function(e){if(new RegExp("({{".concat(e,"}})")).test(n)){var t=r[e]+"";n=n.replace(RegExp.$1,t)}});return n=n.replace(/({{[-\w]*}})/g,"")},_renderShareGuid:function(e){var t=e||{},n=t.query,r=t.shareGuid,o=void 0===r?"":r,i=(t.sequenceInfo||{}).shareGuid;if(!w.isEmpty(i))return i;if(!w.isEmpty(o))return o;var a=w.queryToJson(n);return w.isEmpty(a.share_guid)?w.generateGuid():a.share_guid},_renderForceResult:function(e){return((e||{}).sequenceInfo||{}).forceResult},_renderShareId:function(e){var t=e||{},n=t.id,r=t.query;return n||(w.queryToJson(r).shareConfigId||"")},renderShare:function(e,t){var n=(e||{}).beforeShare,r=w.isFun(n)?n(t):null,o=Object.assign({},t||{},e||{},r||{});return o.shareConfigId=this._renderShareId(o),o.title=this._renderTitle(o),o.shareGuid=this._renderShareGuid(o),o.query=this._renderQuery(o),o.forceResult=this._renderForceResult(o),w.copy(o,["id","gameID","beforeShare","success","fail","complete"])},renderShareThemes:function(e){if(!e||!e.length)return{};var t={},n={};for(var r in e.map(function(e){t[e.type]=t[e.type]||[],t[e.type].push(e)}),t)n[r]=new ze({list:t[r]});return n},renderPostParams:function(e){var t=e||{},n=t.shareConfigId;return{shareConfigId:void 0===n?"":n,customShareType:t.shareType,activityId:t.activityId,content:w.copy(e,["activityId","shareType","shareConfigId"])}}},$e={_canUpdateMenu:ne.canUse("updateShareMenu","1.2.0"),_canUpdatable:ne.canUse("updateShareMenu","2.4.0"),shareAppMessage:function(e){wx.shareAppMessage(e)},onShareAppMessage:function(e){wx.onShareAppMessage(e)},showShareMenu:function(e){wx.showShareMenu(e)},updateShareMenu:function(e){var t=this;return new Promise(function(n,r){(N.log.debug("_canUpdateMenu",t._canUpdateMenu),t._canUpdateMenu)?void 0===e.isUpdatableMessage||t._canUpdatable?wx.updateShareMenu(Object.assign({},e||{},{success:n,fail:r})):r(se.ERR_WX_CANT_UPDATE_SHARE):r(se.ERR_WX_NOT_SUPPORT)})},getShareInfo:function(e){return new Promise(function(t,n){wx.getShareInfo(Object.assign({},e,{success:function(e){"getShareInfo:ok"===e.errMsg?t(e):n(e)},fail:n}))})},setMessageToFriendQuery:function(e){return!!ne.canUse("setMessageToFriendQuery","2.9.0")&&wx.setMessageToFriendQuery(e)},onShareMessageToFriend:function(e){ne.canUse("onShareMessageToFriend","2.9.4")&&wx.onShareMessageToFriend(e)},onInteractiveStorageModified:function(e){ne.canUse("onInteractiveStorageModified","2.9.0")&&wx.onInteractiveStorageModified(e)},navigateToVideoView:function(e){ne.canUse("navigateToVideoView","1.4.0")&&wx.navigateToVideoView(e)}},et=function(){return v(_.mark(function e(){var t;return _.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.wait(1);case 2:return t={withShareTicket:!0,isUpdatableMessage:!1,templateInfo:{}},e.next=5,$e.updateShareMenu(t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}))()};function nt(){return this.forceResult=void 0,this.destroyed=!1,this.inited=!1,this}function rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ot(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?rt(Object(r),!0).forEach(function(n){e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}nt.prototype={init:function(e){if(!this.inited){this.inited=!0;var t=e||{},n=t.forceResult,r=t.shareSuccessDiff,o=t.onShareCallbackTime,i=t.success,a=t.fail,s=t.complete;this.successDiff=r||2e3,this.onCallbackTime=o||500,this.forceResult=n,this.showEnv=this.onShow.bind(this,{success:i,fail:a,complete:s}),this._bind()}},_bind:function(){N.eventBus.on(N.consts.EVT_ON_SHOW,this.showEnv)},_unbind:function(){N.eventBus.off(N.consts.EVT_ON_SHOW,this.showEnv)},onShow:function(e,t){if(!this.destroyed){var n=e||{},r=n.success,o=n.fail,i=n.complete,a=((t||{}).data||{}).hideDuration;this._check(a||0).then(function(e){i&&w.isFun(i)&&i(e),w.isFun(r)&&r(e)}).catch(function(e){i&&w.isFun(i)&&i(e),w.isFun(o)&&o(e)})}},_check:function(e){var t=this;return v(_.mark(function n(){var r,o;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return w.getTime(),r=t.successDiff,t.destroy(),n.next=5,w.wait(t.onCallbackTime);case 5:if(o={isForce:!1,isFake:!0,diffTime:e,successDiff:r,errMsg:"微信分享回调已经废弃，这是模拟分享成功"},t.forceResult!==se.COM_SHARE_RESULT.SUC){n.next=10;break}return o.isForce=!0,o.errMsg="强制分享成功",n.abrupt("return",o);case 10:if(t.forceResult!==se.COM_SHARE_RESULT.FAIL){n.next=14;break}throw o.isForce=!0,o.errMsg="强制分享失败",o;case 14:if(!(e<r)){n.next=17;break}throw o.errMsg="分享操作太快，模拟分享失败",o;case 17:return n.abrupt("return",o);case 18:case"end":return n.stop()}},n)}))()},destroy:function(){this.destroyed||(this._unbind(),this.destroyed=!0)}};var it=N.procCenter,at=N.log,st={withShareTicket:!0,openGetShareTheme:!0,shareSuccessDiff:2e3,onShareCallbackTime:500,useShareAdapter:!0},ct={config:void 0,shareThemesMap:{},diyOptions:null,init:function(){N.eventBus.once(N.consts.EVT_SDK_READY,this._init.bind(this))},_init:function(){var e=this;it.register(N.consts.PROC_REQ_AGGR,this._processReq.bind(this)),this.setConfig(re.getConfig()),$e.showShareMenu({withShareTicket:!0}),this.onShareAppMessage();var t=this.config||{},n=t.openGetShareTheme,r=void 0===n||n,o=t.shareThemes;r&&this._getShareThemes(o).then(function(t){e._setShareThemes(t)}).catch(function(e){at.debug("getShareTheme err",e)}),$e.onShareMessageToFriend(function(e){N.eventBus.dispatch(se.EVT_SHARE_FRIEND,e)})},_processReq:function(e){at.debug("share process aggr req");var t=(e||{}).resp,n=(t||{}).share;return n&&this._setShareThemes(n),t||null},setConfig:function(e){this.config=Object.assign({},this.config||st,e||{})},_setShareThemes:function(e){var t=((e||{}).data||{}).schemes;t&&(this.shareThemesMap=Ze.renderShareThemes(t))},_getShareThemes:function(e){var t=this;return v(_.mark(function n(){var r,o,i,a;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.config||{},o=r.gameId,i={gameID:o},e&&e.length&&(i.shareTypes=e),a="".concat(B()).concat(se.REQ_SHARE_THEME),n.next=6,N.network.post(a,i);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}},n)}))()},_shareStart:function(){this.config.useShareAdapter&&Ye(se.STATUES_SHARING,!0),N.eventBus.dispatch(se.EVT_SHARE_START)},_shareFinish:function(e,t,n,r){this.config.useShareAdapter&&Ye(se.STATUES_SHARING,!1);var o=ot({shareData:t,shareSuccess:n,spentTime:r?Math.max(w.getTime()-r,0):0},e);return N.eventBus.dispatch(se.EVT_SHARE_END,o),o},getShareData:function(e){var t=(this.config||{}).shareData,n=(e||{}).shareType,r=n?this.shareThemesMap[n]:null,o=r?r.getData():t||{};return Ze.renderShare(e,o)},_handleShare:function(e,t,n,r){var o,i=this,a=w.getTime(),s=this.getShareData(e),c=this.config||{},u=c.shareSuccessDiff,f=c.onShareCallbackTime,h=c.useShareAdapter,g=s||{},d=g.shareSuccessDiff,p=g.onShareCallbackTime,_=g.activityId,l=Object.assign({},s,{shareSuccessDiff:d||u,onShareCallbackTime:p||f}),v=t||{},m=v.success,E=v.fail,O=v.complete,S=Ze.renderPostParams(l);h&&(o=new nt);var T=ot({},l,{},{complete:function(e){at.debug("share complete",e),o&&o.destroy(),O&&w.isFun(O)&&O(e),_&&et().catch(function(e){at.debug("update fail",e)})},success:function(e){at.debug("share success",e);var t=i._shareFinish(e,l,!0,a);r||(i._postLog(S,se.LOGTP_SHARE),i._postLog(S,se.LOGTP_SHARE_SUCCESS)),w.isFun(m)&&m(t)},fail:function(e){at.debug("share fail",e);var t=i._shareFinish(e,l,!1,a);w.isFun(E)&&E(t)}});return o&&o.init(T),this._postLog(S,r?se.LOGTP_SHARE:se.LOGTP_SHARE_CALL),this._shareStart(),T},_postLog:function(e,t){N.eventBus.dispatch(N.consts.EVT_REPORT_LOG,{log:ot({},e,{logType:t})})},shareMessage:function(e,t){var n=this;return v(_.mark(function r(){return _.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!Je(se.STATUES_SHARING)){r.next=2;break}throw se.ERR_WX_DUPLICATE_SHARE;case 2:return r.next=4,n._promiseShare(e,t);case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},r)}))()},_promiseShare:function(e,t){var n=this;return new Promise(function(r,o){var i=n._handleShare(e,{success:r,fail:o},t,!1);N.log.debug("[share finalData]",i),$e.shareAppMessage(i)})},onShareAppMessage:function(e){var t=this;$e.onShareAppMessage(function(n){var r=e&&w.isFun(e)?e(n):null,o=r||{},i=o.success,a=o.fail,s=o.complete;return t._handleShare(r,{success:i,fail:a,complete:s},!0,!0)})},getShareInfo:function(e){var t=this;return v(_.mark(function n(){var r,o,i,a,s,c,u,f,h,g,d;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=(e||{}).shareTicket){n.next=3;break}throw se.ERR_WX_PARAMS_ERROR;case 3:return n.next=5,$e.getShareInfo(e);case 5:return o=n.sent,i=t.config||{},a=i.gameId,s=de.getSDKUserInfo()||{},c=s.uniqueId,u="".concat(B()).concat(se.REQ_SHARE_INFO),f=ot({userId:c,gameId:a,shareTicket:r},o),N.log.debug("getShareInfo params",f),n.next=13,N.network.postForm(u,f);case 13:if(h=n.sent,g=h.data,(d=g)&&d.openGId){n.next=18;break}throw se.ERR_WX_GET_SHARE_FAIL;case 18:return n.abrupt("return",d);case 19:case"end":return n.stop()}},n)}))()},sharePointShow:function(e){this._postLog({customShareType:e},se.LOGTP_SHARE_SHOW)},navigateToVideoView:function(e){return new Promise(function(t,n){$e.navigateToVideoView({videoId:e,success:t,fail:n})})},getVideoInfo:function(e){if(!Array.isArray(e))throw new Error("传入参数格式错误");return new Promise(function(t,n){N.global.platform.network.request("POST","https://gate.snssdk.com/developer/api/get_video_info",{alias_ids:e}).then(function(e){var n=e.data,r=n.message,o=n.err_no,i=n.data;t({meta:{errMsg:r,errCode:o},data:i})}).catch(function(e){n(e)})})},getTopVideos:function(e){var t=this;return v(_.mark(function n(){var r,o,i,a;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.config||{},o=r.gameId,i="".concat(M()).concat(se.REQ_TOP_VIDEOS),a=ot({gameId:o},e),n.next=5,N.network.get(i,a);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n)}))()},getVideoRes:function(e){return v(_.mark(function t(){var n,r,o;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)){t.next=2;break}throw new TypeError("请传入 string[] 类型数据");case 2:return n="".concat(M()).concat(se.REQ_VIDEO_INFO),r=e.join(","),o={ids:r},t.next=7,N.network.get(n,o);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t)}))()}};ct.init();var ut={shareMessage:function(e){return ct.shareMessage(e,!0)},shareAppMessage:function(e){return ct.shareMessage(e,!1)},onShareAppMessage:function(e){ct.onShareAppMessage(e)},sharePointShow:function(e){ct.sharePointShow(e)},resetShareConfig:function(e){ct.setConfig(e)},getShareData:function(e){return ct.getShareData(e)},updateShareMenu:function(e){return N.log.debug("updateShareMenu"),$e.updateShareMenu(e)},setMessageToFriendQuery:function(e){return $e.setMessageToFriendQuery(e)},onShareMessageToFriend:function(e){$e.onShareMessageToFriend(e)},onInteractiveStorageModified:function(e){$e.onInteractiveStorageModified(e)},navigateToVideoView:function(e){return ct.navigateToVideoView(e.videoId)},getVideoInfo:function(e){return ct.getVideoInfo(e.videoIds)},getTopVideos:function(e){return ct.getTopVideos(e)},getVideoRes:function(e){return ct.getVideoRes(e.videoIds)}},ft={_canRequestSubMsg:ne.canUse("requestSubscribeMessage","1.7.3"),_canRequestSubscribeWhatsNew:ne.canUse("requestSubscribeWhatsNew","2.10.4"),requestSubscribeMessage:function(e){var t=this;return new Promise(function(n,r){t._canRequestSubMsg?(N.log.debug("tpmlIds:",e.tmplIds),tt.requestSubscribeMessage(Object.assign({},e,{success:n,fail:r}))):r(se.ERR_WX_NOT_SUPPORT)})},getWhatsNewSubscriptionsSetting:function(e){var t=this;return new Promise(function(n,r){t._canRequestSubscribeWhatsNew?wx.getWhatsNewSubscriptionsSetting(Object.assign({},e,{success:n,fail:r})):r(se.ERR_WX_NOT_SUPPORT)})},requestSubscribeWhatsNew:function(e){var t=this;return new Promise(function(n,r){t._canRequestSubscribeWhatsNew?wx.requestSubscribeWhatsNew(Object.assign({},e,{success:n,fail:r})):r(se.ERR_WX_NOT_SUPPORT)})}};function ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var gt={accept:"acceptIds",reject:"rejectIds",ban:"banIds"},dt={request:function(e){var t=this;return v(_.mark(function n(){var r,o,i;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=(e||{}).playerId,n.next=3,ft.requestSubscribeMessage(e);case 3:return o=n.sent,i=t._renderResult(o,r),t._postCount(i,0),n.abrupt("return",i);case 7:case"end":return n.stop()}},n)}))()},_renderResult:function(e,t){var n={playerId:t};for(var r in gt)n[gt[r]]=[];for(var o in e){var i=gt[e[o]];n[i]&&n[i].push(o)}return n},_gameLogin:function(t){return new Promise(function(n,r){var o=re.getConfig(),i=o.gameId,a=o.env,s="https://platform-douyin".concat("Prod"===a?"":"-test",".hortorgames.com/ucenter-douyin-server/api/v1/login/decrypt/userinfo");wx.request({url:s,method:"POST",data:function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ht(Object(r),!0).forEach(function(n){e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},t,{gameId:i}),success:function(e){var t=((e||{}).data||{}).data;t?n(t):r({errCode:10101,errMsg:"获取用户信息失败！"})},fail:r})})},_postCount:function(e){var t=arguments,n=this;return v(_.mark(function r(){var o,i,a,s,c,u,f,h,g,d,p,l,v,m,E,O,S;return _.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=t.length>1&&void 0!==t[1]?t[1]:0,i=n,!(o>3)){r.next=4;break}return r.abrupt("return");case 4:if(a=re.getConfig(),s=a.gameId,c=a.reportSubscribeMessage,a.env,c){r.next=7;break}return r.abrupt("return");case 7:if(f=(u=e||{}).acceptIds,h=void 0===f?[]:f,g=u.playerId,h.length){r.next=10;break}return r.abrupt("return");case 10:if(d=de.getSDKUserInfo()||{},p=d.userId,l=d.uniqueId,p){r.next=30;break}return r.prev=12,r.next=15,He.weakLogin();case 15:return v=r.sent,r.next=18,i._gameLogin(v);case 18:if(m=r.sent,!(E=m.userId)){r.next=24;break}p=E,r.next=25;break;case 24:throw new Error("openId still empty");case 25:r.next=30;break;case 27:r.prev=27,r.t0=r.catch(12),setTimeout(i._postCount.bind(i,e,++o),5e3);case 30:O={gameId:s,playerId:w.toNStr(g),openId:p,uniqueId:l,templateIds:h},S="".concat(B()).concat(se.REQ_SUBSCRIBE_SAVE),N.network.post(S,O).then(function(){N.log.debug("subscribe count add",O)}).catch(function(t){N.log.debug("subscribe count fail",t),setTimeout(n._postCount.bind(n,e,++o),5e3)});case 33:case"end":return r.stop()}},r,null,[[12,27]])}))()}},pt={requestSubscribeMessage:function(e){return dt.request(e)}},_t="sdk_share",lt="sdk_video_ad_show",vt="track",mt="user_set",Et={ALI:1,TGA:2,STD:4,SDK:8},Ot="begin",St="suc",Tt="fail",It="abort",yt="complete",wt={INIT:{topic:"",eventType:vt,eventName:"sdk_init",logType:Et.TGA},LOGIN:{topic:"",eventType:vt,eventName:"sdk_login",logType:Et.TGA},AUTH:{topic:"",eventType:mt,eventName:"sdk_auth",logType:Et.STD},OPEN:{topic:"",eventType:vt,eventName:"sdk_open",logType:Et.STD},CLOSE:{topic:"",eventType:vt,eventName:"sdk_close",logType:Et.STD},SHARE:{topic:"",eventType:vt,eventName:_t,logType:Et.TGA},SHARE_END:{topic:"",eventType:vt,eventName:_t,logType:Et.TGA|Et.STD},VIDEO_AD_SHOW:{topic:"",eventType:vt,eventName:lt,logType:Et.TGA},VIDEO_AD_END:{topic:"",eventType:vt,eventName:lt,logType:Et.TGA|Et.STD},BEAT:{topic:"",eventType:vt,eventName:"sdk_heartbeat",logType:Et.STD},PROFILE:{topic:"",eventType:mt,eventName:"sdk_user_profile",logType:Et.STD},SET_USER_INFO:{topic:"",eventType:mt,eventName:"wx_game_role",logType:Et.STD},SHARE_FRIEND:{topic:"",eventType:vt,eventName:"sdk_share_to_friend",logType:Et.TGA}},bt={};Object.keys(wt).map(function(e){bt[e]=e,wt[e].topic=e});var Rt=wt,At=bt,Dt={getCommonData:function(){var e=this;return v(_.mark(function t(){var n;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.baseData||(e.baseData=e._getBaseData()),t.next=3,e._getChangeData();case 3:return(n=t.sent).clientInfo=Object.assign({},e.baseData?e.baseData.clientInfo:{},n.clientInfo||{}),t.abrupt("return",Object.assign({},e.baseData,n));case 6:case"end":return t.stop()}},t)}))()},getLogDataByTopic:function(e,t){switch(e){case Rt.OPEN.topic:return this._getOpenData(t);case Rt.AUTH.topic:return this._getAuthData(t);case Rt.SHARE.topic:return this._getShareData(t);case Rt.SHARE_END.topic:return this._getShareEndData(t);case Rt.VIDEO_AD_SHOW.topic:return this._getVideoAdPlayData(t);case Rt.VIDEO_AD_END.topic:return this._getVideoAdEndData(t);case Rt.LOGIN.topic:return this._getLoginData(t);case Rt.BEAT.topic:return this._getHeartbeatData(t);case Rt.PROFILE.topic:return this._getUserProfileData(t);case Rt.SET_USER_INFO.topic:return this._getGameUserData(t);default:return this._getBasicData(t)}},refreshDataByTopic:function(e,t){return e===Rt.OPEN.topic?this._refreshOpenData(t):t},_getdistinctId:function(){return this.distinctId||(this.distinctId=w.generateGuid()),this.distinctId},_getBaseData:function(){var e=re.getConfig(),t=e.gameId,n=e.gameVersion,r=ne.getSystemInfo();return{gameId:t,gameVersion:n,logSource:"mini-sdk",clientInfo:{clientType:r.appName,version:r.version,language:r.language,model:r.model,system:r.system,brand:r.brand,pixelRatio:r.pixelRatio,screenWidth:r.screenWidth,screenHeight:r.screenHeight,platform:r.platform,sdkVersion:r.SDKVersion,hsdkVersion:r.hortorSDKVersion}}},_getChangeData:function(){var e=this;return v(_.mark(function t(){var n,r,o,i,a,s,c,u;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e._getdistinctId(),r=de.getSDKUserInfo()||{},o=r.uniqueId,i=r.userId,a=r.channel,s=r.anonymousOpenId,t.next=4,ne.getNetStatus();case 4:return c=t.sent,u=c.networkType,t.abrupt("return",{distinctId:n,platformId:o,openId:i||s,openIdType:i?1:2,channel:a,clientInfo:{netType:u}});case 7:case"end":return t.stop()}},t)}))()},_pkg:function(e,t){return{property:e,extra:t}},_getBasicData:function(e){var t=(e||{}).extend;return this._pkg(null,t)},_getShareData:function(e){var t=(e||{}).extend;return this._pkg({event_step:Ot},t)},_getShareEndData:function(e){var t=e||{},n=t.shareData,r=t.shareSuccess,o=t.spentTime,i=t.extend,a=n||{},s=a.title,c=a.imageUrl,u=a.shareType,f=a.shareConfigId,h=a.shareGuid,g=a.sequenceInfo,d=a.channel,p=a.extra,_=(g||{}).modelId;return p&&(i||(i={}),i.share_extra=JSON.stringify(p)),this._pkg({share_guid:h||"",share_content_id:f||"",share_content_title:s||"",share_content_img:c||"",share_content_type:u||"",share_use_time:o||0,event_state:r?0:1,event_step:r?St:Tt,model_algorithm_id:_||"",share_channel:d||""},i)},_getVideoAdPlayData:function(e){var t=e||{},n=t.adUnitId,r=t.playSuccess,o=t.extend;return this._pkg({ad_id:n||"",event_step:r?St:Ot},o)},_getVideoAdEndData:function(e){var t=e||{},n=t.adUnitId,r=t.isEnded,o=t.playFailCode,i=t.spentTime,a=t.sequenceInfo,s=t.extend,c=a||{},u=c.modelId,f=c.shareGuid,h=void 0===r?-1:r?0:1,g=o?1004===o||1002===o?2:1:0===o?0:1;return this._pkg({ad_id:n||"",event_state:g,ad_close_type:h,ad_show_time:i||0,event_step:g?Tt:h>0?It:yt,model_algorithm_id:u||"",share_guid:f||""},s)},_getGameUserData:function(e){var t=(re.launchOptions()||{}).query,n="toNumber",r={roleId:"toNStr",roleName:"toNStr",serverId:"toNStr",level:n,vipLevel:n,energy:n,money1Consume:n,teamName:"toNStr",teamJob:"toNStr",roleCtime:n,id:"toNStr",wxUnionId:"toNStr",extend:""},o={query_string:JSON.stringify(t)},i=(e||{}).extend;return Object.keys(r).map(function(t){var n=e[t],i=r[t];if(i){var a="user_".concat(w.toLine(t));o[a]=w[i](n)}}),this._pkg(o,i)},_getAuthData:function(e){var t=de.getSDKUserInfo()||{},n=t.name,r=t.sex,o=((re.launchOptions()||{}).query||{}).share_guid,i=e||{},a=i.gender,s=void 0===a?r:a,c=i.nickName,u=void 0===c?n:c,f=i.extend,h=i.avatarUrl,g=i.city,d=i.country,p=i.language,_=i.province;return this._pkg({gender:s||0,nick:u||"",share_guid:o||"",avatar_url:h,city:g,country:d,language:p,province:_},f)},_getOpenData:function(e){var t=(de.getSDKUserInfo()||{}).isNewUser,n=re.launchOptions()||{},r=n.query,o=n.scene,i=n.coldStart,a=n.referrerInfo,s=(r||{}).share_guid,c=e||{},u=c.isColdStart,f=void 0===u?!!i:u,h=c.isNewUser,g=void 0===h?t:h,d=c.extend,p=Object.assign(r,{referrerInfo:a}),_=this._pkg({is_new_user:g?0:1,open_type:f?0:1,source_type_byte:o||"",share_guid:s||"",query_string:JSON.stringify(p)},d);return N.log.debug("onShowReport",_),_},_getUserProfileData:function(e){var t=e||{},n=t.label,r=t.extend;return this._pkg({wx_tags_general:n||0},r)},_getHeartbeatData:function(e){var t=(e||{}).interval;return this._pkg({interval:t||60})},_getLoginData:function(e){var t=(de.getSDKUserInfo()||{}).isNewUser,n=re.launchOptions()||{},r=n.query,o=n.scene,i=(r||{}).shareConfigId,a=e||{},s=a.isNewUser,c=void 0===s?t:s,u=a.extend;return this._pkg({is_new:c,f_share_id:i,wx_scene:o},u)},_refreshOpenData:function(e){var t=(de.getSDKUserInfo()||{}).isNewUser;return e&&e.property&&(e.property.is_new_user=t?0:1),e}},Lt={temps:void 0,report:function(e){var t=this,n=this._getTempLogs(e&&e.logs);if(this._clearTempLogs(),n&&n.length){var r="".concat(B()).concat(se.REQ_STD_LOG),o=Object.assign({},e,{logs:n});N.network.post(r,o).then(function(){N.log.debug("std log",o)}).catch(function(e){e&&e.errCode===N.consts.ERR_NET_FAIL.errCode&&t._setTempLogs(n)})}},_getTempLogs:function(e){return void 0===this.temps&&(this.temps=N.storage.get(se.STG_FAIL_LOGS)),this._limitLogs((this.temps||[]).concat(e||[]))},_setTempLogs:function(e){this.temps=this._limitLogs(e),N.storage.set(se.STG_FAIL_LOGS,this.temps)},_clearTempLogs:function(){this.temps=[],N.storage.set(se.STG_FAIL_LOGS,"")},_limitLogs:function(e){var t=(e?e.length:0)-50;return(e||[]).slice(t>0?t:0)}};function Nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function xt(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?Nt(Object(r),!0).forEach(function(n){e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Nt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var kt={lastLog:{},logs:[],reporting:!1,delayCollect:800,delayReport:5e3,collect:function(e){if(e){var t=e.topic;if(t){var n=this.lastLog[t],r=n&&!n.fromPlatform?n:e;0===((n||{}).params||{}).open_type&&(r.params.open_type=0),this.lastLog[t]=r,n||setTimeout(this._reduceLog.bind(this,t),this.delayCollect)}else this._reportLog(e)}},_reportLog:function(e){var t=e||{},n=t.immediateReport,r=t.params;r&&(this.logs.push(r),this._report(n).catch(function(){}))},_reduceLog:function(e){var t=this.lastLog[e];t&&(this._reportLog(t),this.lastLog[e]=null)},_report:function(e){var t=this;return v(_.mark(function n(){var r,o;return _.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=7;break}if(!t.reporting){n.next=3;break}return n.abrupt("return");case 3:return t.reporting=!0,n.next=6,w.wait(t.delayReport);case 6:t.reporting=!1;case 7:return n.next=9,Dt.getCommonData();case 9:r=n.sent,o=t.logs,Lt.report(xt({},r,{logs:o})),t.logs=[];case 13:case"end":return n.stop()}},n)}))()}};function Pt(e,t,n){return this.guid=w.generateGuid(),this.opt=e,this.topic=e.topic,this.fromPlatform=!!n,this._init(t),this}Pt.prototype={_init:function(e){var t={immediateReport:!1,stopWhenShare:!1,callAfterLogin:!1};switch(this.topic){case Rt.CLOSE.topic:t.stopWhenShare=!0,t.immediateReport=!0;break;case Rt.OPEN.topic:t.stopWhenShare=!0,t.callAfterLogin=this.fromPlatform}this.config=t,this.data={},this.createAt=w.getTime(),this._setData(e)},getConfig:function(){return this.config},start:function(){this.startTime=w.getTime()},stop:function(e){e&&(e.spentTime=this.startTime?Math.max(0,w.getTime()-this.startTime):0),this._setData(e)},refreshData:function(){return this.data=Dt.refreshDataByTopic(this.topic,this.data),this},_setData:function(e){var t=Dt.getLogDataByTopic(this.topic,e),n=t.property,r=t.extra,o=this.data,i=o.property,a=o.extra;return n&&(this.data.property=Object.assign(i||{},n)),r&&(this.data.extra=Object.assign(a||{},r)),this},_getData:function(){var e=this.opt,t=e.eventName,n=e.eventType,r=e.logType;return Object.assign({},this.data,{logId:this.guid,logType:r,eventType:n,eventName:t,timestamp:this.createAt||0})},toLogData:function(){var e=this._getData(),t=this.getConfig().immediateReport;return{topic:this.topic,fromPlatform:this.fromPlatform,immediateReport:t,params:e}}};var Ct={onLoginEvents:[],LogTypes:Et,Topics:At,init:function(){N.eventBus.once(N.consts.EVT_SDK_READY,this._init.bind(this))},_init:function(){var e=this;N.eventBus.on(N.consts.EVT_SET_GAMEUSER,function(t){e.coverLog(At.SET_USER_INFO,t.data)});var t=re.getConfig(),n=t.autoUploadSDTLog,r=t.stdAutoUpload,o=t.tgaAutoUpload,i=t.stdHeartBeatInterval;if(!1!==o||r||n){if(this._report(Rt.INIT,{},!0),N.eventBus.on(N.consts.EVT_ON_SHOW,function(){e._report(Rt.OPEN,null,!0)}),N.eventBus.on(N.consts.EVT_ON_HIDE,function(){e._report(Rt.CLOSE,null,!0)}),N.eventBus.on(se.EVT_SHARE_START,function(t){e._report(Rt.SHARE,t.data,!0)}),N.eventBus.on(se.EVT_SHARE_END,function(t){e._report(Rt.SHARE_END,t.data,!0)}),N.eventBus.on(se.EVT_VIDEO_AD_PLAY_START,function(t){e._report(Rt.VIDEO_AD_SHOW,t.data,!0)}),N.eventBus.on(se.EVT_VIDEO_AD_PLAY_FINISH,function(t){e._report(Rt.VIDEO_AD_END,t.data,!0)}),N.eventBus.on(se.EVT_ON_AUTH,function(t){e._report(Rt.AUTH,t.data,!0)}),N.eventBus.once(N.consts.EVT_ON_LOGIN,function(t){e._report(Rt.LOGIN,t.data,!0),je.getUserGameLabel().then(function(t){e._report(Rt.PROFILE,t,!0)}).catch(function(e){})}),i){var a=i-0||60,s={interval:a};isNaN(a)||w.resetInterval(function(){e._report(Rt.BEAT,s,!0)},1e3*a)}N.eventBus.on(se.EVT_SHARE_FRIEND,function(t){e._report(Rt.SHARE_FRIEND,{extend:t.data},!0)})}},_report:function(e,t,n){var r=Et.TGA,o=Et.STD,i=re.getConfig(),a=i.autoUploadSDTLog,s=i.stdAutoUpload,c=i.tgaAutoUpload,u=e.logType;s||a||(u=(u|o)===u?u^o:u),!1===c&&(u=(u|r)===u?u^r:u),u&&(e.logType=u,this.reportLog(e,t,n))},coverLog:function(e,t){var n=Rt[e];n&&this.reportLog(Object.assign({},n,t||{}),t)},reportLog:function(e,t,n){var r=new Pt(e,t,n),o=re.getConfig().useShareAdapter,i=void 0===o||o,a=r.getConfig(),s=a.stopWhenShare,c=a.callAfterLogin;(!Je(se.STATUES_SHARING)&&i||!s)&&(c?this._callAfterLogin(function(){kt.collect(r.refreshData().toLogData())}):kt.collect(r.toLogData()))},_callAfterLogin:function(e){var t=this;if(w.isFun(e)){var n=de.getSDKUserInfo()||{},r=n.uniqueId;n.userId&&r?e():(this.onLoginEvents.push(e),N.eventBus.once(N.consts.EVT_ON_LOGIN,function(e){t.onLoginEvents.forEach(function(t){return t(e)}),t.onLoginEvents=[]}))}}};Ct.init();var Ut={DefLogTopics:Ct.Topics,coverDefLog:function(e,t){return Ct.coverLog(e,t)},reportGameUserInfo:function(e){return this.coverDefLog(Ct.Topics.SET_USER_INFO,e)},getGameLogTypes:function(){return Ct.LogTypes},postGameLog:function(e){return Ct.reportLog(e,e,!1)}},Vt={_canUseStorage:ne.canUse("setUserCloudStorage","1.9.92"),_canUseGameClub:ne.canUse("createGameClubButton","2.0.3"),_canUserCapture:ne.canUse("onUserCaptureScreen","2.8.1"),setUserCloudStorage:function(e){var t=this;return new Promise(function(n,r){t._canUseStorage?wx.setUserCloudStorage(Object.assign({},e,{success:n,fail:r})):r(se.ERR_WX_NOT_SUPPORT)})},createGameClubButton:function(e){return this._canUseGameClub?wx.createGameClubButton(e):null},onUserCaptureScreen:function(e){this._canUserCapture&&"function"==typeof e&&wx.onUserCaptureScreen(function(t){e(t)})}},Gt={setUserCloudStorage:function(e){return v(_.mark(function t(){return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Vt.setUserCloudStorage(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))()},createGameClubButton:function(e){var t=this,n=Vt.createGameClubButton(e);return n&&n.onTap(function(){t._postGameClubClickLog()}),n},_postGameClubClickLog:function(){var e=re.launchOptions(),t=e.scene,n={channel:(e.custom||{}).channel,scene:t,logType:se.LOGTP_GAME_ZONE};N.eventBus.dispatch(N.consts.EVT_REPORT_LOG,n)}},jt={gameEvent:null,eventBind:!1,init:function(){var e=this;N.eventBus.on(N.consts.EVT_SDK_READY,function(){re.getConfig().reportCaptureScreen&&e.onUserCaptureScreen()})},onUserCaptureScreen:function(e){var t=this;w.isFun(e)&&(this.gameEvent=e),this.eventBind||(this.eventBind=!0,Vt.onUserCaptureScreen(function(e){t.gameEvent&&t.gameEvent(e),N.eventBus.dispatch(N.consts.EVT_REPORT_LOG,{log:{logType:se.LOGTP_USER_CAPTURE_SCREEN}}),N.log.debug("capture screen")}))}};jt.init();var Mt={setUserCloudStorage:function(e){return Gt.setUserCloudStorage(e)},createGameClubButton:function(e){return Gt.createGameClubButton(e)},onUserCaptureScreen:function(e){jt.onUserCaptureScreen(e)}},Bt={_canUseFeedBack:ne.canUse("createFeedbackButton","2.1.2"),_canUseLog:ne.canUse("getLogManager","2.1.0"),getLogManager:function(e){return this._canUseLog?wx.getLogManager(e):null},createFeedbackButton:function(e){return this._canUseFeedBack?wx.createFeedbackButton(e):null}},Ht={logger:null,getLogManager:function(e){return Bt.getLogManager(e)},createFeedbackButton:function(e){return Bt.createFeedbackButton(e)},_log:function(e,t,n){this.logger||(this.logger=this.getLogManager()),this.logger&&this.logger[e]("SDK ".concat(t),n||"")},init:function(){var e=this;N.eventBus.on(N.consts.EVT_UPDATE_START,function(){e._log("log","update start")}),N.eventBus.on(N.consts.EVT_LOGIN_START,function(){e._log("log","login start")}),N.eventBus.on(se.EVT_SESSION,function(t){var n=((t||{}).data||{}).err;if(n)return e._log("warn","checkSession err:",n);e._log("log","checkSession success")}),N.eventBus.on(se.EVT_WX_LOGIN,function(t){var n=((t||{}).data||{}).err;if(n)return e._log("warn","wx login err:",n);e._log("log","wx logined")}),N.eventBus.on(se.EVT_NEED_AUTH,function(){e._log("log","wx need auth")}),N.eventBus.on(se.EVT_ON_AUTH,function(){e._log("log","wx authed")}),N.eventBus.on(N.consts.EVT_ON_LOGIN,function(){e._log("log","logined")}),N.eventBus.on(N.consts.EVT_ON_UPDATE,function(){e._log("log","updated")}),N.eventBus.on(N.consts.EVT_ON_SHOW,function(t){e._log("log","onshow")}),N.eventBus.on(N.consts.EVT_ON_ERROR,function(t){e._log("warn","onerr:",t&&t.data)}),N.eventBus.on(se.EVY_PAY_FAIL,function(t){e._log("warn","pay fail:",t&&t.data)}),N.eventBus.on(se.EVT_VIDEO_AD_ERROR,function(t){e._log("warn","video ad err:",t&&t.data)})}};Ht.init();var Ft=function(e){return v(_.mark(function t(){var n,r,o,i,a,s;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n="".concat(M()).concat(se.REQ_SENSITIVE_MSG),r=re.getConfig(),o=r.gameId,i={gameId:o,msg:e,tp:"text"},t.next=6,N.network.post(n,i);case 6:if(a=t.sent,s=a.data){t.next=10;break}throw N.consts.ERR_NET_FAIL;case 10:return t.abrupt("return",s);case 13:throw t.prev=13,t.t0=t.catch(0),N.log.warn("checkSensitiveMsg err",t.t0),w.pkgError(t.t0,N.consts.ERR_NET_FAIL);case 17:case"end":return t.stop()}},t,null,[[0,13]])}))()},Wt=function(e){return v(_.mark(function t(){var n,r,o,i,a,s,c,u,f,h,g;return _.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.imageUrl,r=e.imageData,o=e.threshold,i=void 0===o?.6:o,a=e.targets,n||r){t.next=3;break}return t.abrupt("return",N.log.warn("请输入需要检测的图片URL或者图片base64数据"));case 3:return t.prev=3,s="".concat(M()).concat(se.REQ_SENSITIVE_MSG),c=re.getConfig(),u=c.gameId,f={gameId:u,tp:"image"},n&&(f.imageUrl=n),r&&(f.imageData=r),i&&i.length&&(f.threshold=i),a&&a.length>0&&(f.targets=a),t.next=13,N.network.post(s,f);case 13:if(h=t.sent,g=h.data){t.next=17;break}throw N.consts.ERR_NET_FAIL;case 17:return t.abrupt("return",g);case 20:throw t.prev=20,t.t0=t.catch(3),N.log.warn("checkSensitiveImg err",t.t0),w.pkgError(t.t0,N.consts.ERR_NET_FAIL);case 24:case"end":return t.stop()}},t,null,[[3,20]])}))()};function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}var Qt=function(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?qt(Object(r),!0).forEach(function(n){e(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qt(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({},{},{},_e,{},le,{},Oe,{},Te,{},we,{},Le,{},ke,{},Pe,{},Ve,{},Ge,{},He,{},{checkSensitiveMsg:function(e){return Ft(e)},checkSensitiveImg:function(e){return Wt(e)}},{},Ke,{},ut,{},Ut,{},pt,{},Mt,{},{getLogManager:function(e){return Ht.getLogManager(e)},createFeedbackButton:function(e){return Ht.createFeedbackButton(e)}});module.exports=Qt.default||Qt}();
